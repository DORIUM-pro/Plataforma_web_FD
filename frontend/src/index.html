<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio | Frijolitos Dormilones</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="mensaje-bienvenida" style="display:none;"></div>
  <div class="logo-header">
    <a href="index.html">
      <img src="img/logo.png" alt="Frijolitos Dormilones" class="logo-img">
    </a>
  </div>
  <!-- Barra de login/registro SIEMPRE visible (el JS la oculta si hay usuario logueado) -->
  <div class="cuadro-login" id="navbar-derecha">
    <a href="login.html" class="btn-login">Iniciar sesión</a>
    <a href="registro.html" class="btn-registro">Registrarse</a>
  </div>

  <!-- Info de usuario autenticado -->
  <div id="usuario-info" style="display:none;">
    <span id="usuario-nombre"></span>
    <button id="cerrar-sesion-top" class="btn-cerrar-sesion-rojo">Cerrar sesión</button>
  </div>

  <!-- Panel lateral de usuario moderno a la izquierda (oculto por defecto) -->
  <aside id="panel-usuario" class="panel-usuario abierto" style="display:none;">
    <button id="toggle-panel-usuario" class="toggle-panel" aria-label="Ocultar panel">
      <span id="flecha-panel">&#x25C0;</span>
    </button>
    <div class="panel-contenido">
      <h3>Mi cuenta</h3>
      <div id="usuario-detalles">
        <p><strong>Nombre:</strong> <span id="panel-nombre"></span></p>
        <p><strong>Correo:</strong> <span id="panel-correo"></span></p>
        <p><strong>Rol:</strong> <span id="panel-rol"></span></p>
      </div>
      <ul>
        <li><a href="perfil.html">Ver perfil</a></li>
        <li><a href="mis-reservas.html">Mis reservas</a></li>
        <li><a href="logout.html" id="panel-cerrar-sesion">Cerrar sesión</a></li>
      </ul>
    </div>
    <div id="panel-mini" class="panel-mini" tabindex="0" aria-label="Mostrar panel de usuario">
      <img class="icono-perfil" src="img/perfil.png" alt="Foto de perfil">
      <span class="texto-mini">Mi perfil</span>
      <span class="flecha-mini">&#x25B6;</span>
    </div>
  </aside>

  <header id="hero">
    <div class="hero-overlay">
      <h1 class="eslogan">El arte de soñar envuelto en naturaleza</h1>
      <a href="#reservas" class="btn-reservar">Reservar ahora</a>
    </div>
  </header>
  
  <!-- Sección Experiencia Frijolitos Dormilones -->
  <section id="experiencia-frijolitos">
    <h2 class="seccion-titulo">La experiencia Frijolitos Dormilones</h2>
    <div class="experiencia-grid">
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono hoja (inmersión) -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48"><ellipse cx="24" cy="24" rx="18" ry="25" stroke="#2a4a29" stroke-width="2"/><path d="M24,5 Q29,21 18,43" stroke="#2a4a29" stroke-width="1.5" fill="none"/></svg>
        </div>
        <h3>Inmersión en la naturaleza</h3>
        <p>Despierta rodeado de bosque, aire puro y sonidos naturales. Cada cápsula es un mirador privilegiado al paisaje.</p>
      </div>
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono de esfera/lujo (circle with glow) -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48"><circle cx="24" cy="24" r="18" stroke="#dbc178" stroke-width="2"/><circle cx="24" cy="24" r="11" stroke="#dbc178" stroke-width="1.5" fill="none" opacity="0.5"/></svg>
        </div>
        <h3>Lujo suspendido</h3>
        <p>Vive una noche única en nuestras esferas flotantes. Diseño elegante con máxima comodidad y vistas incomparables.</p>
      </div>
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono de reciclaje/sostenibilidad -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48">
            <path d="M19 8 L24 3 L29 8" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M7 24 A16 16 0 0 1 32 8" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M29 40 L24 45 L19 40" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M41 24 A16 16 0 0 1 16 40" stroke="#489554" stroke-width="2" fill="none"/>
          </svg>
        </div>
        <h3>Sostenibilidad</h3>
        <p>Cada detalle minimiza el impacto ambiental: materiales eco, energía renovable y un compromiso real con la naturaleza.</p>
      </div>
    </div>
  </section>
  
  <!-- Sección Las Lunas (Galería de Alojamientos) -->
  <section id="lunas">
    <h2 class="seccion-titulo">Nuestras Lunas</h2>
    <div class="lunas-grid">
      <!-- Luna 1 -->
      <div class="luna-card disponible">
        <div class="luna-img-wrap">
          <!-- Placeholder de imagen -->
          <img src="https://placehold.co/600x400/3686da/ffffff?text=Luna+Moon" alt="Luna Moon" class="luna-img">
          <span class="badge disponible">Disponible</span>
        </div>
        <div class="luna-contenido">
          <h3>Moon</h3>
          <p>Ideal para parejas. Cama king, jacuzzi privado y vista panorámica al bosque.</p>
          <button class="btn-vermas" data-luna="Moon">Ver más</button>
        </div>
      </div>

      <!-- Luna 2 -->
      <div class="luna-card promo">
        <div class="luna-img-wrap">
          <img src="https://placehold.co/600x400/39b16a/ffffff?text=Luna+Sky" alt="Luna Sky" class="luna-img">
          <span class="badge promo">Promoción</span>
        </div>
        <div class="luna-contenido">
          <h3>Sky</h3>
          <p>Suspensión más alta, malla catamarán y cine bajo estrellas. Sujeto a promo limitada.</p>
          <button class="btn-vermas" data-luna="Sky">Ver más</button>
        </div>
      </div>

      <!-- Luna 3 -->
      <div class="luna-card">
        <div class="luna-img-wrap">
          <img src="https://placehold.co/600x400/e3c072/ffffff?text=Luna+Forest" alt="Luna Forest" class="luna-img">
          <!-- Sin indicador -->
        </div>
        <div class="luna-contenido">
          <h3>Forest</h3>
          <p>Rodeada de vegetación nativa. Avistamiento de aves y baño en medio del bosque.</p>
          <button class="btn-vermas" data-luna="Forest">Ver más</button>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Sección de reservas (Solo un enlace) -->
  <div class="container" id="reservas">
    <a href="reserva.html" class="btn-reservar-grande">Reservar ahora</a>
  </div>

  <!-- Botón de reservar flotante para Móvil -->
  <a href="reserva.html" class="btn-flotante">Reservar</a>

  <!-- Modal para detalles de Luna -->
  <div id="modal-luna" class="modal-luna" style="display:none;">
    <div class="modal-content">
      <span id="modal-cerrar" class="modal-cerrar" title="Cerrar">&times;</span>
      <div id="modal-luna-body">
        <!-- Info dinámica aquí -->
      </div>
    </div>
  </div>

  <footer id="footer">
    <div class="footer-content">
      <p>© 2023 Frijolitos Dormilones - Todos los derechos reservados</p>
    </div>
  </footer>

  <script>
    // --- Código de modales y bienvenida ---
    const modal = document.getElementById('modal-luna');
    const modalBody = document.getElementById('modal-luna-body');
    const modalCerrar = document.getElementById('modal-cerrar');
    const nombre = localStorage.getItem('nombre');
    
    // Manejador para botones "Ver más" de las lunas
    document.querySelectorAll('.btn-vermas').forEach(btn => {
      btn.addEventListener('click', function() {
        const lunaId = this.getAttribute('data-luna');
        mostrarDetalleLuna(lunaId);
      });
    });
    
    // Función para mostrar el modal con detalles de la luna
    function mostrarDetalleLuna(lunaId) {
      const contenidoLunas = {
        'Moon': `
          <h2>Luna Moon</h2>
          <img src="https://placehold.co/600x400/3686da/ffffff?text=Luna+Moon" alt="Luna Moon" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Moon es ideal para parejas que buscan una experiencia romántica en medio de la naturaleza. Cuenta con:</p>
          <ul>
            <li>Cama king size con vista panorámica</li>
            <li>Jacuzzi privado bajo las estrellas</li>
            <li>Desayuno gourmet incluido</li>
            <li>Terraza privada</li>
          </ul>
          <p><strong>Precio:</strong> $180.000 por noche</p>
        `,
        'Sky': `
          <h2>Luna Sky</h2>
          <img src="https://placehold.co/600x400/39b16a/ffffff?text=Luna+Sky" alt="Luna Sky" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Sky ofrece la experiencia más elevada de nuestro complejo:</p>
          <ul>
            <li>Suspensión a 8 metros de altura</li>
            <li>Malla catamarán para contemplar las estrellas</li>
            <li>Sistema de cine bajo las estrellas</li>
            <li>Servicio de cena romántica opcional</li>
          </ul>
          <p><strong>Promoción actual:</strong> 15% de descuento en reservas de 2 noches</p>
        `,
        'Forest': `
          <h2>Luna Forest</h2>
          <img src="https://placehold.co/600x400/e3c072/ffffff?text=Luna+Forest" alt="Luna Forest" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Forest te sumerge en la experiencia más natural:</p>
          <ul>
            <li>Rodeada de vegetación nativa</li>
            <li>Punto privilegiado para avistamiento de aves</li>
            <li>Baño al aire libre con total privacidad</li>
            <li>Sendero privado hacia el río</li>
          </ul>
          <p><strong>Precio:</strong> $160.000 por noche</p>
        `
      };
      
      modalBody.innerHTML = contenidoLunas[lunaId] || `<p>Información no disponible para Luna ${lunaId}</p>`;
      modal.style.display = 'flex';
    }
    
    // Cerrar modal al hacer clic en X
    modalCerrar.addEventListener('click', function() {
      modal.style.display = 'none';
    });
    
    // Cerrar modal al hacer clic fuera del contenido
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // --- Código de bienvenida y paneles ---
    const bienvenida = localStorage.getItem('bienvenida');
    if (bienvenida === '1' && nombre) {
      const mensajeBienvenida = document.getElementById('mensaje-bienvenida');
      mensajeBienvenida.textContent = `¡Bienvenid@, ${nombre}!`;
      mensajeBienvenida.style.display = 'block';
      setTimeout(() => {
        mensajeBienvenida.style.display = 'none';
        localStorage.removeItem('bienvenida');
      }, 3000);
    }

    // Mostrar u ocultar opciones según login
    const navbar = document.getElementById('navbar-derecha');
    const usuarioInfo = document.getElementById('usuario-info');
    const usuarioNombre = document.getElementById('usuario-nombre');
    const btnCerrarSesion = document.getElementById('cerrar-sesion');
    const btnCerrarSesionTop = document.getElementById('cerrar-sesion-top');
    const panelUsuario = document.getElementById('panel-usuario');

    function usuarioLogueado(nombre) {
      return (
        nombre &&
        typeof nombre === "string" &&
        nombre.trim() !== "" &&
        nombre !== "null" &&
        nombre !== "undefined"
      );
    }

    // Mostrar/ocultar panel lateral según login
    if (usuarioLogueado(nombre)) {
      if (panelUsuario) panelUsuario.style.display = 'block';
      if (navbar) navbar.style.display = 'none';
      if (usuarioInfo) {
        usuarioInfo.style.display = 'flex';
        usuarioNombre.textContent = `¡Hola, ${nombre}!`;
      }
    } else {
      if (panelUsuario) panelUsuario.style.display = 'none';
      if (navbar) navbar.style.display = 'flex';
      if (usuarioInfo) usuarioInfo.style.display = 'none';
    }

    // Cerrar sesión (superior)
    if (btnCerrarSesionTop) {
      btnCerrarSesionTop.onclick = function() {
        localStorage.clear();
        window.location.href = "index.html";
      };
    }

    // Cerrar sesión desde el panel lateral
    if (btnCerrarSesion) {
      btnCerrarSesion.onclick = function(e) {
        e.preventDefault();
        localStorage.clear();
        window.location.href = "index.html";
      };
    }

    // Panel lateral de usuario: mostrar datos
    const panelNombre = document.getElementById('panel-nombre');
    const panelCorreo = document.getElementById('panel-correo');
    const panelRol = document.getElementById('panel-rol');

    const nombreUsuario = localStorage.getItem('nombre') || 'Invitado';
    const correoUsuario = localStorage.getItem('correo') || 'No disponible';
    const rolUsuario = localStorage.getItem('rol') || 'No asignado';

    if (panelNombre) panelNombre.textContent = nombreUsuario;
    if (panelCorreo) panelCorreo.textContent = correoUsuario;
    if (panelRol) panelRol.textContent = rolUsuario;

    // Mostrar/ocultar panel lateral moderno
    const togglePanelBtn = document.getElementById('toggle-panel-usuario');
    const panelMini = document.getElementById('panel-mini');
    if (togglePanelBtn && panelUsuario) {
      togglePanelBtn.onclick = function() {
        if (panelUsuario.classList.contains('abierto')) {
          panelUsuario.classList.remove('abierto');
          panelUsuario.classList.add('cerrado');
        } else {
          panelUsuario.classList.remove('cerrado');
          panelUsuario.classList.add('abierto');
        }
      };
    }
    if (panelMini && panelUsuario) {
      panelMini.onclick = function() {
        panelUsuario.classList.remove('cerrado');
        panelUsuario.classList.add('abierto');
      };
      // Accesibilidad: permitir abrir con Enter/Espacio
      panelMini.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          panelUsuario.classList.remove('cerrado');
          panelUsuario.classList.add('abierto');
        }
      });
    }
  </script>
</body>
</html>
