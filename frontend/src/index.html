<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inicio | Frijolitos Dormilones</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="logo-header">
    <a href="index.html">
      <img src="img/logo.png" alt="Frijolitos Dormilones" class="logo-img">
    </a>
  </div>
  <!-- Barra de login/registro -->
  <div class="navbar-derecha" id="navbar-derecha">
    <a href="login.html" class="btn-login">Iniciar sesión</a>
    <a href="registro.html" class="btn-registro">Registrarse</a>
  </div>

  <!-- Info de usuario autenticado -->
  <div id="usuario-info">
    <span id="usuario-nombre"></span>
    <button id="cerrar-sesion">Cerrar sesión</button>
  </div>

  <div id="admin-panel" style="display:none;">
    <!-- Opciones de administración aquí -->
    <ul>
      <li><a href="admin.html">Gestión de usuarios</a></li>
      <li><a href="reservas-admin.html">Gestión de reservas</a></li>
      <li><a href="reportes.html">Ver reportes</a></li>
    </ul>
  </div>
  <div id="cliente-panel">
    <h3>Mi espacio</h3>
    <ul>
      <li><a href="mis-reservas.html">Mis reservas</a></li>
      <li><a href="perfil.html">Mi perfil</a></li>
    </ul>
  </div>

  <header id="hero">
    <div class="hero-overlay">
      <h1 class="eslogan">El arte de soñar envuelto en naturaleza</h1>
      <a href="#reservas" class="btn-reservar">Reservar ahora</a>
    </div>
  </header>
  
  <!-- Sección Experiencia Frijolitos Dormilones -->
  <section id="experiencia-frijolitos">
    <h2 class="seccion-titulo">La experiencia Frijolitos Dormilones</h2>
    <div class="experiencia-grid">
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono hoja (inmersión) -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48"><ellipse cx="24" cy="24" rx="18" ry="25" stroke="#2a4a29" stroke-width="2"/><path d="M24,5 Q29,21 18,43" stroke="#2a4a29" stroke-width="1.5" fill="none"/></svg>
        </div>
        <h3>Inmersión en la naturaleza</h3>
        <p>Despierta rodeado de bosque, aire puro y sonidos naturales. Cada cápsula es un mirador privilegiado al paisaje.</p>
      </div>
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono de esfera/lujo (circle with glow) -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48"><circle cx="24" cy="24" r="18" stroke="#dbc178" stroke-width="2"/><circle cx="24" cy="24" r="11" stroke="#dbc178" stroke-width="1.5" fill="none" opacity="0.5"/></svg>
        </div>
        <h3>Lujo suspendido</h3>
        <p>Vive una noche única en nuestras esferas flotantes. Diseño elegante con máxima comodidad y vistas incomparables.</p>
      </div>
      <div class="experiencia-bloque">
        <div class="experiencia-icono">
          <!-- Icono de reciclaje/sostenibilidad -->
          <svg width="48" height="48" fill="none" viewBox="0 0 48 48">
            <path d="M19 8 L24 3 L29 8" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M7 24 A16 16 0 0 1 32 8" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M29 40 L24 45 L19 40" stroke="#489554" stroke-width="2" fill="none"/>
            <path d="M41 24 A16 16 0 0 1 16 40" stroke="#489554" stroke-width="2" fill="none"/>
          </svg>
        </div>
        <h3>Sostenibilidad</h3>
        <p>Cada detalle minimiza el impacto ambiental: materiales eco, energía renovable y un compromiso real con la naturaleza.</p>
      </div>
    </div>
  </section>
  
  <!-- Sección Las Lunas (Galería de Alojamientos) -->
  <section id="lunas">
    <h2 class="seccion-titulo">Nuestras Lunas</h2>
    <div class="lunas-grid">
      <!-- Luna 1 -->
      <div class="luna-card disponible">
        <div class="luna-img-wrap">
          <!-- Placeholder de imagen -->
          <img src="https://placehold.co/600x400/3686da/ffffff?text=Luna+Moon" alt="Luna Moon" class="luna-img">
          <span class="badge disponible">Disponible</span>
        </div>
        <div class="luna-contenido">
          <h3>Moon</h3>
          <p>Ideal para parejas. Cama king, jacuzzi privado y vista panorámica al bosque.</p>
          <button class="btn-vermas" data-luna="Moon">Ver más</button>
        </div>
      </div>

      <!-- Luna 2 -->
      <div class="luna-card promo">
        <div class="luna-img-wrap">
          <img src="https://placehold.co/600x400/39b16a/ffffff?text=Luna+Sky" alt="Luna Sky" class="luna-img">
          <span class="badge promo">Promoción</span>
        </div>
        <div class="luna-contenido">
          <h3>Sky</h3>
          <p>Suspensión más alta, malla catamarán y cine bajo estrellas. Sujeto a promo limitada.</p>
          <button class="btn-vermas" data-luna="Sky">Ver más</button>
        </div>
      </div>

      <!-- Luna 3 -->
      <div class="luna-card">
        <div class="luna-img-wrap">
          <img src="https://placehold.co/600x400/e3c072/ffffff?text=Luna+Forest" alt="Luna Forest" class="luna-img">
          <!-- Sin indicador -->
        </div>
        <div class="luna-contenido">
          <h3>Forest</h3>
          <p>Rodeada de vegetación nativa. Avistamiento de aves y baño en medio del bosque.</p>
          <button class="btn-vermas" data-luna="Forest">Ver más</button>
        </div>
      </div>
    </div>
  </section>
  
  <div class="container" id="reservas">
    <form id="form-reserva" class="form-card" autocomplete="off">
      <div class="form-title">Reserva tu Frijolito Dormilón</div>
      <div id="mensaje-bienvenida" style="display:none; text-align:center; margin: 16px 0; font-size:1.1em; color:#3686da;"></div>
      <div class="input-group">
        <label for="cliente_id">Cliente ID</label>
        <input id="cliente_id" type="number" name="cliente_id" required placeholder="Ej: 12"/>
      </div>
      <div class="input-group">
        <label for="habitacion_id">Habitación ID</label>
        <input id="habitacion_id" type="number" name="habitacion_id" required placeholder="Ej: 2"/>
      </div>
      <div class="input-group">
        <label for="fecha_inicio">Fecha inicio</label>
        <input id="fecha_inicio" type="date" name="fecha_inicio" required />
      </div>
      <div class="input-group">
        <label for="fecha_fin">Fecha fin</label>
        <input id="fecha_fin" type="date" name="fecha_fin" required />
      </div>
      <div class="input-group">
        <label for="precio_total">Precio total</label>
        <input id="precio_total" type="number" name="precio_total" required placeholder="Ej: 180000"/>
      </div>
      <div class="input-group">
        <label for="estado">Estado</label>
        <select id="estado" name="estado" required>
          <option value="Activa">Activa</option>
          <option value="Cancelada">Cancelada</option>
        </select>
      </div>
      <button type="submit">Reservar</button>
      <!-- Aquí aparecerán avisos de sugerencias -->
      <div id="aviso-sugerencias" class="aviso"></div>
    </form>
  </div>

  <!-- Botón de reservar flotante para Móvil -->
  <a href="#reservas" class="btn-flotante">Reservar</a>

  <!-- Modal para detalles de Luna -->
  <div id="modal-luna" class="modal-luna" style="display:none;">
    <div class="modal-content">
      <span id="modal-cerrar" class="modal-cerrar" title="Cerrar">&times;</span>
      <div id="modal-luna-body">
        <!-- Info dinámica aquí -->
      </div>
    </div>
  </div>

  <footer id="footer">
    <div class="footer-content">
      <p>© 2023 Frijolitos Dormilones - Todos los derechos reservados</p>
    </div>
  </footer>

  <script>
    const form = document.getElementById('form-reserva');
    const aviso = document.getElementById('aviso-sugerencias');
    const modal = document.getElementById('modal-luna');
    const modalBody = document.getElementById('modal-luna-body');
    const modalCerrar = document.getElementById('modal-cerrar');
    const nombre = localStorage.getItem('nombre');
    
    // Manejador para botones "Ver más" de las lunas
    document.querySelectorAll('.btn-vermas').forEach(btn => {
      btn.addEventListener('click', function() {
        const lunaId = this.getAttribute('data-luna');
        mostrarDetalleLuna(lunaId);
      });
    });
    
    // Función para mostrar el modal con detalles de la luna
    function mostrarDetalleLuna(lunaId) {
      // Contenido dinámico según la luna seleccionada
      const contenidoLunas = {
        'Moon': `
          <h2>Luna Moon</h2>
          <img src="https://placehold.co/600x400/3686da/ffffff?text=Luna+Moon" alt="Luna Moon" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Moon es ideal para parejas que buscan una experiencia romántica en medio de la naturaleza. Cuenta con:</p>
          <ul>
            <li>Cama king size con vista panorámica</li>
            <li>Jacuzzi privado bajo las estrellas</li>
            <li>Desayuno gourmet incluido</li>
            <li>Terraza privada</li>
          </ul>
          <p><strong>Precio:</strong> $180.000 por noche</p>
        `,
        'Sky': `
          <h2>Luna Sky</h2>
          <img src="https://placehold.co/600x400/39b16a/ffffff?text=Luna+Sky" alt="Luna Sky" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Sky ofrece la experiencia más elevada de nuestro complejo:</p>
          <ul>
            <li>Suspensión a 8 metros de altura</li>
            <li>Malla catamarán para contemplar las estrellas</li>
            <li>Sistema de cine bajo las estrellas</li>
            <li>Servicio de cena romántica opcional</li>
          </ul>
          <p><strong>Promoción actual:</strong> 15% de descuento en reservas de 2 noches</p>
        `,
        'Forest': `
          <h2>Luna Forest</h2>
          <img src="https://placehold.co/600x400/e3c072/ffffff?text=Luna+Forest" alt="Luna Forest" style="width:100%; border-radius:8px; margin:15px 0;">
          <p>La Luna Forest te sumerge en la experiencia más natural:</p>
          <ul>
            <li>Rodeada de vegetación nativa</li>
            <li>Punto privilegiado para avistamiento de aves</li>
            <li>Baño al aire libre con total privacidad</li>
            <li>Sendero privado hacia el río</li>
          </ul>
          <p><strong>Precio:</strong> $160.000 por noche</p>
        `
      };
      
      // Actualizar contenido del modal
      modalBody.innerHTML = contenidoLunas[lunaId] || `<p>Información no disponible para Luna ${lunaId}</p>`;
      
      // Mostrar modal
      modal.style.display = 'flex';
    }
    
    // Cerrar modal al hacer clic en X
    modalCerrar.addEventListener('click', function() {
      modal.style.display = 'none';
    });
    
    // Cerrar modal al hacer clic fuera del contenido
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
    
    function limpiarAviso() {
      aviso.className = 'aviso';
      aviso.style.display = 'none';
      aviso.innerHTML = "";
    }
    
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      limpiarAviso();

      const datos = Object.fromEntries(new FormData(form).entries());
      const urlBackend = 'http://localhost:3000/api/reservas';
      
      try {
        const resp = await fetch(urlBackend, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(datos)
        });
        const data = await resp.json();

        if(resp.status === 201) {
          aviso.innerHTML = `<span class="icono">✔️</span>¡Reserva creada exitosamente!`;
          aviso.className = "aviso exito";
          form.reset();
        } else if(resp.status === 409 && data.detalle && data.detalle.sugerencias_libres) {
          let html = `<span class="icono">💡</span><b>${data.error}</b><br>Alternativas de fechas disponibles: <ul>`;
          data.detalle.sugerencias_libres.forEach(sug => {
            html += `<li>${sug.mensaje}</li>`;
          });
          html += '</ul>';
          aviso.innerHTML = html;
          aviso.className = "aviso aviso";
        } else if(data.error) {
          aviso.innerHTML = `<span class="icono">❌</span>${data.error}`;
          aviso.className = "aviso error";
        }
        aviso.style.display = "block";
      } catch (err) {
        aviso.innerHTML = `<span class="icono">❌</span>Error al conectar con el backend.`;
        aviso.className = "aviso error";
        aviso.style.display = "block";
      }
    });
    
    // Mostrar mensaje de bienvenida solo después del login
    const bienvenida = localStorage.getItem('bienvenida');
    if (bienvenida === '1' && nombre) {
      const mensajeBienvenida = document.getElementById('mensaje-bienvenida');
      mensajeBienvenida.textContent = `¡Bienvenido, ${nombre}!`;
      mensajeBienvenida.style.display = 'block';
      setTimeout(() => {
        mensajeBienvenida.style.display = 'none';
        localStorage.removeItem('bienvenida');
      }, 3000);
    }

    // Mostrar u ocultar opciones según login
    const navbar = document.getElementById('navbar-derecha');
    const usuarioInfo = document.getElementById('usuario-info');
    const usuarioNombre = document.getElementById('usuario-nombre');
    const btnCerrarSesion = document.getElementById('cerrar-sesion');

    if (nombre) {
      // Oculta login/registro y muestra info usuario
      if (navbar) navbar.style.display = 'none';
      if (usuarioInfo) {
        usuarioInfo.style.display = 'block';
        usuarioNombre.textContent = `¡Hola, ${nombre}!`;
      }
    } else {
      // Muestra login/registro y oculta info usuario
      if (navbar) navbar.style.display = 'block';
      if (usuarioInfo) usuarioInfo.style.display = 'none';
    }

    // Cerrar sesión
    if (btnCerrarSesion) {
      btnCerrarSesion.onclick = function() {
        localStorage.clear();
        window.location.href = "index.html";
      };
    }

    const rol = localStorage.getItem('rol');
    const adminPanel = document.getElementById('admin-panel');
    const clientePanel = document.getElementById('cliente-panel');

    document.addEventListener('DOMContentLoaded', function() {
      const rol = localStorage.getItem('rol');
      const adminPanel = document.getElementById('admin-panel');
      if (adminPanel) {
        if (rol === 'admin' || rol === 'administrador') {
          adminPanel.style.display = 'block';
        } else {
          adminPanel.style.display = 'none';
        }
      }
    });
  </script>
</body>
</html>
